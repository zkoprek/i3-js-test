<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="main.css">
    <title>Document</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>
<body>
    <div class="centered">
        <h1>WELCOME TO THE QUIZ!</h1>
    </div>

    <div class="game">
        <div id="slides" class="slidebar">
            <button id="btn1" class="slide green" onclick="changeQ(this.id)">1</button>
            <button id="btn2" class="slide blue" onclick="changeQ(this.id)">2</button>
            <button id="btn3" class="slide yellow" onclick="changeQ(this.id)">3</button>
            <button id="btn4" class="slide brown" onclick="changeQ(this.id)">4</button>
        </div>

        
        <button id="mobileSlides" style='display:none;' onclick="slider()">Q</button>
        <div id="0" class="content">
            <div class="qText">
                What's up? Are you ready to take the quiz? <br>
                Start by clicking on any question.
            </div>

        </div>

        <div id="ctn1" class="content" style='display:none;'>
            <div class="centered">
                <button id="btc2" class="next" onclick="changeQ(this.id)">Next</button>
                <div class="qText">Question 1</div>
            </div>
        </div>

        <div id="ctn2" class="content" style='display:none;'>
            <div class="centered">
                <button id="btc1" class="prev" onclick="changeQ(this.id)">Previous</button>
                <button id="btc3" class="next" onclick="changeQ(this.id)">Next</button>
                <div class="qText">Question 2</div>
            </div>
        </div>

        <div id="ctn3" class="content" style='display:none;'>
            <div class="centered">
                <button id="btc2" class="prev" onclick="changeQ(this.id)">Previous</button>
                <button id="btc4" class="next" onclick="changeQ(this.id)">Next</button>
                <div class="qText">Question 3</div>
            </div>
        </div>

        <div id="ctn4" class="content" style='display:none;'>
            <div class="centered">
                <button id="btc3" class="prev" onclick="changeQ(this.id)">Previous</button>
                <button id="showResultsBtn" class="next" onclick="showResults()" disabled>Show results</button>
                <div class="qText">Question 4</div>
            </div>
        </div>

        <div id="ctnShowResults" class="content" style='display:none;'></div>
    </div>

    <div id="alertBox" style='display:none;'>You have selected too many answers!<div></div>
</body>
<script>

    const shownArr = [];
    var clickedAnswersArr = [];
    var clickedAnswersEach = [];
    var answersCtn1 = [];
    var answersCtn2 = [];
    var answersCtn3 = [];
    var answersCtn4 = [];
    const forbidden = [];

    function slider () {
        var slidesDiv = document.getElementById("slides");
        var mobileSlides = document.getElementById("mobileSlides");

        if (slidesDiv.classList.contains("showSlides")) {
            slidesDiv.classList.remove("showSlides");
            mobileSlides.classList.remove("moveMobileSlides");
        } else {
            slidesDiv.classList.add("showSlides");
            mobileSlides.classList.add("moveMobileSlides");
        }
    }
    
	function changeQ (id) {

        document.getElementById("ctnShowResults").classList.remove("showSlides");
        id = id.slice(3);

        elements = document.getElementsByClassName("slide");
        for (var i = 0; i < elements.length; i++) {
            elements[i].style.backgroundColor="white";
        }

        document.getElementById("btn"+id).style.backgroundColor = "rgb(150, 255, 150)";

        hideAll();
        showCtn(id);
    }

    function hideAll () {
        elements = document.getElementsByClassName("content");
        for (var i = 0; i < elements.length; i++) {
            elements[i].style.display="none";
        }
    }

    function showCtn (id){

        var qstsDiv = document.createElement("div");
        qstsDiv.classList.add("questions");

        var tag = "ctn" + id;
        var ctnShow = document.getElementById(tag);
        ctnShow.style.display="block";

        var randNum = Math.floor(Math.random() * (6 - 0 + 1)) + 0;
        
        if (!shownArr.includes(id)){
            for (var i=0; i<randNum+2; i++) {

                var qst = document.createElement("button");
                qst.classList.add("qst");
                qst.classList.add("slide"+id);
                qst.setAttribute("id", "slide" + id + "Btn" + i);
                qst.onclick = function() { answerBtnClicked(this.id); };
                qst.appendChild(document.createTextNode(i));

                qstsDiv.appendChild(qst);
            }

            document.getElementById(tag).appendChild(qstsDiv);
            shownArr.push(id);
        }
    }

    function answerBtnClicked (id) {
        clickedAnswersEach.push(id);

        var idW = id;
        var button = id.slice(9);

        var slideW = idW.slice(0,6);
        var slide = slideW.slice(5);

        if (!forbidden.includes(slide)) {

            var answerBtn = document.getElementById("slide"+slide+"Btn"+button);
            answerBtn.style.backgroundColor="rgb(255, 178, 116)";

            myDivObj = document.getElementById("slide"+slide+"Btn"+button); 
            let myDivObjBgColor = window.getComputedStyle(myDivObj).backgroundColor;

            clickedAnswersArr.push(slide);
        } else {
            displayAlertTooMany(slide);
        }

    }
    
    clickedAnswersArr.push = function() { Array.prototype.push.apply(this, arguments);  showResultsBtnCheck();};

    function showResultsBtnCheck () {

        const counts = {};

        for (const num of clickedAnswersArr) {
            counts[num] = counts[num] ? counts[num] + 1 : 1;
        }

        if (counts[1] == 3) {forbidden.push('1');}
        if (counts[1] > 3) {
            displayAlertTooMany('1');
        }

        if (counts[2] == 4) forbidden.push('2');
        if (counts[2] > 4) {
            displayAlertTooMany('2');
        }

        if (counts[3] == 5) forbidden.push('3');
        if (counts[3] > 5) {
            displayAlertTooMany('3');
        }

        if (counts[4] == 6) forbidden.push('4');
        if (counts[4] > 6) {
            displayAlertTooMany('4');
        }

        if (clickedAnswersArr.includes("1")) document.getElementById("btn1").classList.add("chosenAnswer");
        if (clickedAnswersArr.includes("2")) document.getElementById("btn2").classList.add("chosenAnswer");
        if (clickedAnswersArr.includes("3")) document.getElementById("btn3").classList.add("chosenAnswer");
        if (clickedAnswersArr.includes("4")) document.getElementById("btn4").classList.add("chosenAnswer");

        if (clickedAnswersArr.includes("1") && clickedAnswersArr.includes("2") && clickedAnswersArr.includes("3") && clickedAnswersArr.includes("4")) {
            const button = document.getElementById('showResultsBtn');
            button.disabled = false;
        }
    }

    function displayAlertTooMany(ctn){
        document.getElementById("alertBox").classList.add("showSlides");
    }

    function showResults () {

        for(var i in clickedAnswersEach) {
            var idW = clickedAnswersEach[i];
            var button = clickedAnswersEach[i].slice(9);

            var slideW = idW.slice(0,6);
            var slide = slideW.slice(5);
            
            if (slide == '1') answersCtn1.push(button);
            if (slide == '2') answersCtn2.push(button);
            if (slide == '3') answersCtn3.push(button);
            if (slide == '4') answersCtn4.push(button);
        }
        
        getResultString();
    }

    function getResultString () {
        answersCtn1 = [...new Set(answersCtn1)];
        answersCtn2 = [...new Set(answersCtn2)];
        answersCtn3 = [...new Set(answersCtn3)];
        answersCtn4 = [...new Set(answersCtn4)];

        if (answersCtn1.length > 3) {
            var lastN = answersCtn1.length - 3;
            answersCtn1.splice(1, lastN);
        }

        if (answersCtn2.length > 4) {
            var lastN = answersCtn2.length - 4;
            answersCtn2.splice(1, lastN);
        }

        if (answersCtn3.length > 5) {
            var lastN = answersCtn3.length - 5;
            answersCtn3.splice(1, lastN);
        }

        if (answersCtn4.length > 6) {
            var lastN = answersCtn4.length - 6;
            answersCtn4.splice(1, lastN);
        }

        var resultString = "Results:</br>Question 1: ";

        for (var i in answersCtn1) {
            resultString += answersCtn1[i] + ", ";
        }
        resultString = resultString.substring(0, resultString.length - 2);
        resultString += "</br>"

        resultString += "Question 2: ";
        for (var i in answersCtn2) {
            resultString += answersCtn2[i] + ", ";
        }
        resultString = resultString.substring(0, resultString.length - 2);
        resultString += "</br>"

        resultString += "Question 3: ";
        for (var i in answersCtn3) {
            resultString += answersCtn3[i] + ", ";
        }
        resultString = resultString.substring(0, resultString.length - 2);
        resultString += "</br>"

        resultString += "Question 4: ";
        for (var i in answersCtn4) {
            resultString += answersCtn4[i] + ", ";
        }
        resultString = resultString.substring(0, resultString.length - 2);
        resultString += "</br>"

        document.getElementById("ctnShowResults").innerHTML = resultString;
        document.getElementById("ctnShowResults").classList.add("showSlides");
        document.getElementById("ctn4").style.display="none";
    }

</script>

</html>